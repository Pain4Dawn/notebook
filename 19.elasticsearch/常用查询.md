## 排序

```
# post
iisop_flow_begin_20220627,iisop_flow_end_20220627/_search
{
  "sort": [
    {
      "@timestamp": "desc"
    },
    "total_price",
    "_score"
  ]
} 
```
### 索引不同类型排序
+ numeric_type对类型进行转换,可转换的类型为["double","long","date","date_nanos"]
```
GET /offline_sales,online_sales/_search
{
"sort":[{"total_price":{"numeric_type":"long"}}]
}
```
+ 对数据结构提供根据mode设置类型进行排序的策略,有min,max,sum,avg,median
```
GET offline_sales/_search
{
  "sort":[
    {
      "price_list":{
        "mode":"min",
        "order":"asc"
      }
    }
  ]
}
```



### 清空缓存

```
curl -XPOST localhost:2900/_cache/clear?pretty
curl -XPOST localhost:9200/index/_cache/clear?pretty
curl -XPOST localhost:9200/index1,index2,index3/_cache/clear?pretty
```



### 过滤查询条件

```
{
  "from": 0,
  "query": {
    "bool": {
      "filter": [
        {
          "bool": {
            "must": {
              "terms": {
                "geo_dip_city": [
                  "东京"
                ]
              }
            }
          }
        },
        {
          "range": {
            "@timestamp": {
              "from": 1655049600000,
              "include_lower": true,
              "include_upper": true,
              "to": 1655172120000
            }
          }
        }
      ],
      "must": {
        "query_string": {
          "query": " protocol : ( TCP ) "
        }
      }
    }
  },
  "size": 0
}
```

term查询

```
{
  "query": {
    "term": {
      "ip_addr": "192.168.0.0/16"
    }
  }
}
```



## mapping

```
http://localhost:12900/test_ip/
{
  "mappings": {
    "properties": {
      "ip_addr": {
        "type": "ip"
      }
    }
  }
}
```

## 插入数据

```
http://localhost:12900/test_ip/_doc/1/
{
  "ip_addr": "192.168.1.1"
}
```

## querystring使用
会有特殊字符，使用\转义
```
+ - && || ! () {} [] ^" ~ * ? : \    以上字符当作值搜索的时候需要用\转义
```

## 脚本查询
```
// 时间做减法需要做数值转换
{
  "query": {
    "bool": {
      "filter": {
        "script": {
          "script": {
            "lang": "painless",
            "source": "doc['@timestamp'].date.dayOfYear-doc['c_time_ts'].date.dayOfYear > 1"
          }
        }
      }
    }
  }
}
```
[时间转换数字接口](https://www.elastic.co/guide/en/elasticsearch/reference/6.2/modules-scripting-expression.html#_date_field_api)