# 磁盘

## 磁盘的扩展方式

+ 普通磁盘挂载
+ 逻辑卷
+ RAID
+ 分布式

## 概述

磁盘是计算机外设，一块磁盘需要经历，分区（为了更好的管理磁盘），格式化分区（生成不同的文件系统）。磁盘分区需要引导区，引导区记录分区的位置。多个磁盘无法跨磁盘分区。这样就需要通过逻辑卷的方式来实现磁盘扩容。不过往往中间件会支持磁盘扩容的策略，本文只是介绍单机版磁盘扩容的方式。

## 分区

一块盘分区需要关注：

+ 分区商用属性：设备，是否是引导区，开始结束位置
+ 常用指令：fdisk

```shell
fdisk -l  # 查看分区
fdisk /dev/sda # 开始分区
```



## 格式化

把分区指定为特定的文件系统

```shell
mkfs.ext4
```

## 挂载

将linux文件路径指定文件系统主要分为临时挂载和永久挂载

```shell
mount # 挂载
umount # 解卦
df -h # 查看系统设置的文件系统及挂载点的使用情况
```

永久挂载使用/etc/fstab

## 逻辑卷

逻辑卷是为了解决多块磁盘共用，动态扩展文件。如果中间件不支持多文件使用时，使用。核心思想是将硬盘划分为物理卷，物理卷组成卷组，卷组可以划分逻辑卷。卷组和逻辑卷都可以动态扩容。

```shell
pvcreate /dev/sdb /dev/sdc # 格式化PV
pvdisplay  # 查看PV信息
vgcreate xiaoluo /dev/sdb /dev/sdc # 创建卷组
vgdisplay # 查看卷组
vgextend xiaoluo /dev/sdd1 # 扩展卷组
lvcreate -n mylv -L 2G xiaoluo # 创建逻辑卷
lvdisplay # 查看逻辑卷
mkfs.ext4 /dev/xiaoluo/mylv # 格式化逻辑卷
lvextend /dev/centos/root /dev/sda3 # 扩展逻辑分区
xfs_growfs  /dev/vg1/lv1 # xfs扩展
```

注意事项：

+ 必须要先分区然后初始化文件系统

  ## 列出磁盘信息
  
  ```
  lsblk
  ```
  
  
  
  
  
  

[CentOS：添加硬盘并初始化 - 简书 (jianshu.com)](https://www.jianshu.com/p/fb5f82cf7153)

[一篇看懂！Linux磁盘的管理（分区、格式化、挂载），LVM逻辑卷，RAID磁盘阵列 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/296777898)

## 数据库

我删数据时，能否插入数据

插入数据，能否删数据



|                                          | 没有数据                                               |                    |      |      |
| ---------------------------------------- | ------------------------------------------------------ | ------------------ | ---- | ---- |
| （带id）先执行插入，再执行删除           | 没有阻塞，删除没启作用，根据mvcc版本控制删除并没有影响 |                    |      |      |
| （不带id）先执行删除，再执行插入         | 会锁表，造成所有插入都是阻塞状态，只有拿到锁后才能执行 |                    |      |      |
| （不是唯一索引条件时）先删除，再执行插入 | 会找到唯一id锁上无法插入                               |                    |      |      |
| 先插入，再执行删除                       |                                                        | 在没提交时不会影响 |      |      |

## 结论

先插入时不会锁表



删除

